{{ define "hero" }}
    <header class="header-hero shadow-2xl relative overflow-hidden">
        <div class="absolute hero-clouds w-full z-0"><img src="/images/hero-clouds.svg" alt=""></div>
        <div class="header-hero-items two-thirds relative container mx-auto z-10">
            <div class="header-hero-item">
                <h1>{{ .Title }}</h1>
                <p class="text-xl leading-relaxed">
                    {{ .Description }}
                </p>
                <div class="header-hero-actions">
                    <a class="btn btn-lg" href="#">
                        Some Button
                    </a>
                    <a class="btn btn-lg btn-orange-translucent" href="#">
                        Some Other Button
                    </a>
                </div>
            </div>
            <div class="header-hero-item">
                <img class="w-64 mx-auto" src="/images/mascot/pulumipus.svg" alt="">
            </div>
        </div>
    </header>
{{ end }}

{{ define "main" }}
    {{/* Iterate over all pages, making two lists -- one for modules, another for topics. */}}
    {{ $allModules := slice }}
    {{ $allTopics := slice }}
    {{ range where .Site.Pages "Section" "learn" }}
        {{ if eq .Kind "page"  }}
            {{ $allModules = $allModules | append .Page }}
        {{ end }}
    {{ end }}

    <nav class="nav-section-sticky">
        <div class="container mx-auto uppercase">
            <ul>
                <li><a href="#">Modules</a></li>
                <li><a href="#">Examples</a></li>
                <li><a href="#">Other Interestingness</a></li>
            </ul>
        </div>
    </nav>
    <div class="container mx-auto px-4 py-8 mt-2">
        <h2>{{ .Params.modules.title }}</h2>
        <p class="mb-0">
            {{ .Params.modules.description }}
        </p>
    </div>
    <div class="container mx-auto md:flex flex-wrap my-4">
        {{ if gt (len $allModules) 0 }}
            {{ range $allModules }}
                {{ $module := . }}
                {{ $topics := slice }}

                {{ range $allTopics }}
                    {{ $topic := . }}
                    {{ if hasPrefix $topic.File.Dir $module.File.Dir }}
                        {{ $topics = $topics | append $topic }}
                    {{ end }}
                {{ end }}

                <div class="md:w-1/3 rounded bg-gray-100 p-8 m-4 shadow hover:shadow-lg">
                    {{ if .Params.meta_image }}
                        <a href="{{ .RelPermalink }}">
                            <img
                                class="rounded"
                                src="{{ (.Resources.GetMatch .Params.meta_image).RelPermalink }}"
                            alt="{{ .Title }}">
                        </a>
                    {{ end }}
                    <h3>{{ $module.Title }}</h3>
                    <p>
                        {{ $module.Description }}
                    </p>
                    <p>
                        {{ len $topics }} topic{{ if ne (len $topics) 1}}s{{ end }}
                    </p>
                </div>
            {{ end }}
        {{ else }}
            <div class="mx-4">
                <p class="my-0">None.</p>
            </div>
        {{ end }}
    </div>
{{ end }}
